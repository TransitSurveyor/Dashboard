{% extends "onoff/base.html" %}


{% block dashboard %}
{{ super() }}
<br>

<div style="margin:2px">
<table>
  <tr>
    <td style="padding-right:1em">
      <strong>Route:</strong>
    </td>
    <td>
      <div class="btn-group" role="form">
        <button id="line_btn" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
        All    <span class="caret"></span>
        </button>
        <ul id="filter_line" class="dropdown-menu scrollable-menu" role="menu">
          <li role="presentation" class="dropdown-header">Route</li>
          <li role="presentation"><a href="#">All</a></li>
          <li role="presentation" class="divider"></li>    
          <li><a href="#">9-Powell Blvd</a></li>
          <li><a href="#">17-Holgate/Broadway</a></li>
          <li><a href="#">33-McLoughlin</a></li>
        </ul>
      </div>
    </td>
  </tr>
</table>
</div>

<br>

<div style="margin:2px; margin-top:10px">
<div id="status-table" class="table-responsive panel panel-default">
  <table class="table table-bordered">
    <thead>
      <tr>
        <th rowspan="2" colspan="1"></th>
        <th colspan="3" class="text-center">Total</th>
        <th colspan="3" class="text-center">Inbound</th>
        <th colspan="3" class="text-center">Outbound</th>
      </tr>
      <tr>
        <th class="text-center">Target</th>
        <th class="text-center">Count</th>
        <th class="text-center">PCT</th>
        <th class="text-center">Target</th>
        <th class="text-center">Count</th>
        <th class="text-center">PCT</th>
        <th class="text-center">Target</th>
        <th class="text-center">Count</th>
        <th class="text-center">PCT</th>
      </tr>
    </thead> 
    <!-- fill in body from json status data -->
    <tbody>  
      <tr id="row-all"><th>All</th></tr>
      <tr id="row-6"><th>6a</th></tr>
      <tr id="row-7"><th>7a</th></tr>
      <tr id="row-8"><th>8a</th></tr>
      <tr id="row-9"><th>9a</th></tr>
      <tr id="row-10"><th>10a</th></tr>
      <tr id="row-11"><th>11a</th></tr>
      <tr id="row-12"><th>12p</th></tr>
      <tr id="row-13"><th>1p</th></tr>
      <tr id="row-14"><th>2p</th></tr>
      <tr id="row-15"><th>3p</th></tr>
      <tr id="row-16"><th>4p</th></tr>
      <tr id="row-17"><th>5p</th></tr>
      <tr id="row-18"><th>6p</th></tr>
      <tr id="row-19"><th>7p</th></tr>
      <tr id="row-20"><th>8p</th></tr>
      <tr id="row-21"><th>9p</th></tr>
      <tr id="row-22"><th>10p</th></tr>
    </tbody>
  </table>
</div>
</div>
<script>

var sel_line = null;


function rebuild(args) {
    console.log(args);
    $.getJSON('status/_data', args, function(data) {
        console.log(data);
        
        // clear table body cells

        // for each rowdata in data ['All', '6a', '7a', ... , '10p']
        //      construct each cell and append to correct table row

        /*
        clear table and rebuild with fetched json
        console.log(data);
        $("#tbody").empty();
        $(data.data).each(function(index, item) {
            var date = '<td>'+item.date+'</td>';
            var time = '<td>'+item.time+'</td>';
            var user = '<td>'+item.user+'</td>';
            var line = '<td>'+item.rte_desc+'</td>';
            var dir = '<td>'+item.dir_desc+'</td>';
            var on = '<td>'+item.on_stop+'</td>';
            var off = '<td>'+item.off_stop+'</td>';
            var row = '<tr>'+date+time+user+line+dir+on+off+'</tr>';
            $("#tbody").append(row);
        });
        */

    });
}


$('#filter_line a').on('click', function() {
    sel_line = this.text
    $("#line_btn").text(this.text+' ').append('<span class="caret"></span>');
    if (sel_line == 'All') sel_line = '';
    rebuild({'rte_desc':sel_line});
});
  
    
    
    
    
    /*
    function build_cell(text, pct) {
        var td = $('<td>');
        //td.text(text);
        if(pct) {
            if(pct > 100) text = "100%";
            else text = pct.toString() + "%";
            td.attr("class", get_status(pct));
        }
        if(text == 'N/A') {
            td.attr("class", "status-none");
        }
        td.text(text);
        td.attr("align", "center");
        return td;
    }
    
    function get_status(pct_complete) {
        var cls = "";
        switch (Math.floor(pct_complete / 25) + 1) {
            //0% -> 24%
            case 1:
                cls = "status-1";
                break;
            //25% -> 49%  
            case 2:
                cls = "status-2";
                break;
            //50% -> 74%    
            case 3:
                cls = "status-3";               
                break;
            //75% -> 99%    
            case 4: 
                cls = "status-4";
                break;
            //100% +    
            default:
                cls = "status-complete";
        }
        return cls;
    }
  
    function get_number(data) {
        var ret_val = "";
        if(!$.isEmptyObject(data)) {
            ret_val = (data['count'].toString() + '/' + data['target'].toString())
        }
        return ret_val;
    }

    function get_pct(data) {
        var ret_val = 0;
        if(!$.isEmptyObject(data)) {
            ret_val= ((data['count'] / data['target']) * 100).toFixed(0);
        }
        return ret_val;
    }

    
    function build_stats_row(rte_desc, data, summary_data) {
        var array = [];
        var nbsp = "N/A";
        array[0] = rte_desc
       
        var tr = $('<tr>');
            tr.append($('<th>').text(rte_desc));
            tr.append(build_cell(get_number(summary_data), get_pct(summary_data))); 
        
        for(var i = 0; i < 4; i++) {
            if (!$.isEmptyObject(data['1'][times[i]])) {
                tr.append(
                    build_cell(
                        get_number(data['1'][times[i]]),
                        get_pct(data['1'][times[i]])
                    )
                );
            }
            else {
                tr.append(build_cell(nbsp, null));
            }   
        }
        for(var i = 4; i < 8; i++) {                
            if (!$.isEmptyObject(data['0'][times[i - 4]])) {
                tr.append(
                    build_cell(
                        get_number(data['0'][times[i - 4]]),
                        get_pct(data['0'][times[i - 4]])
                    )
                );
            }
            else {
                tr.append(build_cell(nbsp, null));
            }
        }
        return tr;
    }
    
    var routes = { routes|tojson|safe };
   
    //var data = { data|tojson|safe };
    //var summary = { summary|tojson|safe };

    //console.log(summary);
    //var streetcar = { streetcar|tojson|safe };
    //var times = ['AM Peak', 'Midday', 'PM Peak', 'Evening'];

    $(routes).each(function(index, item) {
        console.log(item)
        var tr = $('<tr>');
        tr.append($('<th>').text(item));
        
        //if (item.indexOf('Portland Streetcar') < 0) {
        //    tr = build_stats_row(item, data[item], summary[item]);
       // }
        //else {
         //   tr.append($('<th>').text(item));
        //    tr.append(
       //         $('<td>').text(get_pct(streetcar[item]).toString() + '%')
       //             .attr("colspan", "9")
       //             .attr("class", get_status(get_pct(streetcar[item])))
       //             .attr("align", "center")
       //     );
        //}
        $("#status-table tbody").append(tr);
    
    });
*/
</script>

{% endblock %}

